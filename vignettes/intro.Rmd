---
title: "Causal Mediation Analysis Estimating Interventional Effects Mapped to a Target Trial"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Causal Mediation Analysis Estimating Interventional Effects Mapped to a Target Trial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: "../inst/references.bib"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Background

Causal mediation analysis methods are commonly used in research studies to explore the causal pathways linking exposures to outcomes. Traditional mediation analysis aims to decompose the total effect of an exposure into natural direct and indirect effects, with natural indirect effects capturing the exposure effect acting through the mediator. However, the ultimate goal of research studies, especially in health and medical research, is often to elucidate the extent to which hypothetical interventions targeting mediators could counter exposure effects. This suggests that a shift in focus is warranted, from effect decomposition to explicitly evaluating hypothetical mediator interventions that may inform future policy, practice and intervention development.

Interventional effects [@vanderweele2014effect] are mediation estimands that are more aligned with this interventional focus while addressing key identifiability challenges associated with natural effects [@Robins1992]. Indeed, interventional effects have been shown to implicitly emulate effects in target trials [@hernan2016using] assessing the impact of distributional shifts in mediators [@MorenoBetancur2018]. Based on this concept, @Moreno2021Mediation proposed definitions of interventional effects that map explicitly to a target trial assessing hypothetical mediator interventions of specific interest, making them particularly useful for policy-relevant evaluations in applied research as illustrated in several published examples [@Dashti2022; @Goldfeld2023; @Afshar2024].

## Define interventional effects and estimation methods

@Moreno2021Mediation provided definitions for interventional effects based on three types of hypothetical mediator interventions. In this vignette, we describe these estimands and their corresponding mediator interventions, as implemented in the `medRCT` R package. The type of mediator intervention can be specified using the argument `intervention_type`. By default, `intervention_type = "all"` estimates all three types of interventional effects. Other available options are:
 
 - **`shift_all`**:  
  This estimand corresponds to an intervention that shifts the **joint distribution of all mediators** in the exposed to match the corresponding distribution in the unexposed.
 - **`shift_k`**:  
  This estimand corresponds to an intervention that shifts the **distribution of a specific mediator** in the exposed to match the corresponding distribution in the unexposed, **without considering flow-on effects** on other mediators.

 - **`shift_k_order`**:  
  This estimand corresponds to an intervention that shifts the **distribution of a specific mediator** in the exposed to match the corresponding distribution in the unexposed, **while considering flow-on effects** on causally descendant mediators.

`medRCT` estimates interventional effects based on these interventions using a Monte Carlo simulation-based g-computation approach, as described by @Vansteelandt2017. The number of Monte Carlo simulations can be specified using the argument `mcsim`, allowing users to balance computational efficiency and estimation accuracy. Additionally, `medRCT` automatically removes missing values from the dataset, performing a complete-case analysis.


## Getting started with `medRCT`: Estimating interventional effects

The `medRCT` package is designed to handle complex mediation settings involving **multiple interrelated mediators** and **intermediate confounders** (exposure-induced mediator-outcome confounders). It supports a range of variable types. Specifically, it supports **categorical exposures** with two or more levels (Levels $\geq$ 2). For the **outcome variable**, `medRCT` supports both **binary** and **continuous** outcomes. Additionally, it supports any number of mediators and each **mediator**, including those that are not of primary interest but **intermediate confounders**, can be either **binary** or **continuous**. Any number of **baseline confounders** of any type are supported. This makes the package suitable for a broad range of real-world applications in epidemiology, public health, and social science research. 

We begin by illustrating how to estimate the three different types of interventional effects in the presence of multiple mediators and intermediate confounders. Such intermediate confounders can be specified using the argument `intermediate_confs`. Consider the following example using simulated data inspired by a case study within the Longitudinal Study of Australian Children (LSAC) [@Goldfeld2023]. Specifically, we aim to estimate the difference in expected outcome (risk of mental health problems) under exposure (low socioeconomic position) with versus without a hypothetical intervention that individually shifts the distribution of each mediator (parental mental health and preschool attendance) to the levels in the unexposed, while accounting for baseline confounders, an intermediate (exposure-induced) mediator-outcome confounder and correlations amongst mediators.


```{r}
library(medRCT)

# Set a seed for reproducibility
set.seed(2024)
# Display the first few rows of the dataset
head(LSACdata)

# Define confounders for the analysis
confounders <- c("child_sex", "child_atsi", "mat_cob", "mat_engl", "mat_age")

# Define intermediate confounders
intermediate_confs <- "fam_stress"

# Estimate interventional indirect effects
med_res <- medRCT(
  dat = LSACdata,                      
  exposure = "sep",                    
  outcome = "child_mh",                
  mediators = c("parent_mh", "preschool_att"), 
  intermediate_confs = intermediate_confs, 
  confounders = confounders,
  interactions_XC = "all",
  intervention_type = "all",
  bootstrap = TRUE,
  boot_args = list(R = 100, stype = "i", ci.type = "norm"),
  mcsim = 100                          
)

# Summarise the results
summary(med_res)
```

In the summary table:  

- `IIE_all` is the estimated interventional indirect effect when applying the hypothetical intervention specified by `shift_all`. A hypothetical intervention improving both the mental health of parents of children and preschool attendance in low socioeconomic position to the levels in those with high socioeconomic position could potentially prevent 1 per 100 cases of child mental health problems.

- `IIE_k` is the estimated interventional indirect effect when applying the hypothetical intervention described by `shift_k` to a specific mediator `k`. A hypothetical intervention improving the mental health of parents of children (IIE_1) in low socioeconomic position to the levels in those with high socioeconomic position could potentially prevent 1 per 100 cases of child mental health problems. Meanwhile, the effect of a hypothetical intervention on preschool attendance (IIE_2) is negligible.

- `IIE_k_prime` is the estimated interventional indirect effect for a specific mediator `k`, accounting for the flow-on effects on its descendant mediators under the hypothetical intervention described by `shift_k_order`. A hypothetical intervention improving the mental health of parents of children (IIE_1_prime) in low socioeconomic position to the levels in those with high socioeconomic position, while accounting for flow-on effects on preschool attendance, could potentially prevent 1 per 100 cases of child mental health problems. 

- `TCE` is the estimated total causal effect.


## Specifying interactions with `interactions_XC`

The argument `interactions_XC` in `medRCT` allows users to specify two-way interactions amongst exposure and baseline confounders. Of note, the algorithm automatically includes all two-way interactions among the exposure, mediators, and intermediate confounders. These interaction terms are fixed and cannot be modified by the user.

#### Default option:  
- By default, `interactions_XC = "all"` includes **all two-way interactions** between the exposure and baseline confounders, while **baseline confounder-baseline confounder interactions are excluded**.

#### Removing interactions:  
- Setting `interactions_XC = "none"` **removes all two-way interactions** involving the exposure and baseline confounders.  

#### Custom interactions:  
- **Custom specification:** Users can manually specify interaction terms by providing the model formula in the format `interactions_XC = "exposure:confounder1 + exposure:confounder2"`. This option provides full control over interaction terms between the exposure and baseline confounders in the model, enabling customisation for specific research questions.  

## Special cases

#### Analysis without intermediate confounders

If there are **no intermediate confounders** in the analysis, set the argument **`intermediate_confs = NULL`** when calling the `medRCT` function, as described in the following example:

```{r eval=FALSE}
med_res <- medRCT(
  dat = LSACdata,
  exposure = "sep",
  outcome = "child_mh",
  mediators = c("parent_mh", "preschool_att"),
  intermediate_confs = intermediate_confs,
  confounders = confounders,
  interactions_XC = "all",
  intervention_type = "all",
  intermediate_confs = NULL,
  bootstrap = TRUE,
  boot_args = list(R = 100, stype = "i", ci.type = "norm"),
  mcsim = 100
)
```


#### Single mediator case:  
If there is only **one mediator**, only the `intervention_type` **`shift_k`** can be estimated, as the other options (`shift_all` and `shift_k_order`) require **multiple mediators** to define meaningful interventional effects.

#### Causal ordering for the estimation of the estimand `shift_k_order`:  
When estimating the estimand `shift_k_order`, the **order of mediators** specified in the argument **`mediators`** is important, as it defines the **causal ordering** among the mediators. This ordering determines the **causal descendants** for the mediator of interest, providing essential information for **accounting for flow-on effects** after the hypothetical intervention. Specifying an incorrect mediator ordering may result in **biased estimates** for the estimand `shift_k_order`. 

## Model diagnostics

We have developed a **Shiny** application for convenient model diagnostics, which can be launched using the command:  

```r
medRCT_shiny(dat = data)
```
In the Shiny application, after specifying the relevant arguments and clicking the `Run medRCT models` button, the app will fit all regression models required by the `medRCT` algorithm and generate detailed summaries for each model. These summaries support model assessment, allowing users to identify potential issues with fitting what are usually richly-specified models.

Additionally, any **warnings** or **error messages** encountered during the model fitting process are highlighted in the app. By offering a user-friendly interface and diagnostic tool, our Shiny app streamlines the model diagnostics process for the `medRCT` algorithm, facilitating transparent and comprehensive model assessment.


## References
